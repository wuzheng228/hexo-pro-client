# 图床配置指南

本文档介绍如何配置和使用 hexo-pro-client 的图床功能。

## 功能概述

hexo-pro-client 支持以下图床类型：
- **本地存储**：将图片存储在本地文件系统中
- **阿里云 OSS**：使用阿里云对象存储服务
- **七牛云**：使用七牛云存储服务
- **腾讯云 COS**：使用腾讯云对象存储服务

## 基本配置

### 1. 本地存储配置

本地存储是默认选项，无需安装额外依赖。

**配置步骤：**
1. 进入设置页面
2. 在"图床设置"区域选择"本地存储"
3. 设置自定义存储路径（默认为 `images`）
4. 配置会自动保存

**自定义路径说明：**
- 路径相对于 Hexo 项目的 `source` 目录
- 例如设置为 `assets/images`，图片将存储在 `source/assets/images/` 目录中
- 支持中文路径名

### 2. 阿里云 OSS 配置

**安装依赖：**
```bash
cd hexo-pro
npm install ali-oss
```

**配置步骤：**
1. 登录阿里云控制台，创建 OSS Bucket
2. 获取以下信息：
   - Region（地域）：如 `oss-cn-hangzhou`
   - Bucket 名称
   - AccessKey ID 和 AccessKey Secret
3. 进入设置页面，选择"阿里云 OSS"
4. 填写配置信息：
   - **地域**：OSS 地域标识符
   - **Bucket名称**：创建的存储桶名称
   - **Access Key ID**：访问密钥 ID
   - **Access Key Secret**：访问密钥
   - **自定义域名**（可选）：CDN 加速域名，留空使用默认 OSS 域名

### 3. 七牛云配置

**安装依赖：**
```bash
cd hexo-pro
npm install qiniu
```

**配置步骤：**
1. 登录七牛云控制台，创建对象存储空间
2. 获取以下信息：
   - 存储区域
   - 空间名称
   - AccessKey 和 SecretKey
   - CDN 加速域名
3. 进入设置页面，选择"七牛云"
4. 填写配置信息：
   - **存储区域**：选择对应的存储区域
   - **空间名称**：创建的存储空间名称
   - **Access Key**：访问密钥
   - **Secret Key**：安全密钥
   - **访问域名**：CDN 加速域名（必填）

**存储区域对应关系：**
- 华东：z0
- 华北：z1
- 华南：z2
- 北美：na0
- 东南亚：as0

### 4. 腾讯云 COS 配置

**安装依赖：**
```bash
cd hexo-pro
npm install cos-nodejs-sdk-v5
```

**配置步骤：**
1. 登录腾讯云控制台，创建 COS 存储桶
2. 获取以下信息：
   - 地域
   - 存储桶名称（包含 APPID）
   - SecretId 和 SecretKey
3. 进入设置页面，选择"腾讯云 COS"
4. 填写配置信息：
   - **地域**：如 `ap-beijing`
   - **存储桶名称**：完整的存储桶名称（格式：bucketname-appid）
   - **Secret ID**：密钥 ID
   - **Secret Key**：密钥
   - **自定义域名**（可选）：CDN 加速域名

## 使用说明

### 图片上传

配置完成后，所有图片上传操作（包括编辑器中的图片上传、图床管理页面的上传等）都会根据当前配置的图床类型进行处理。

### 图床切换

可以随时在设置页面切换图床类型，但请注意：
- 切换图床类型不会迁移已有图片
- 建议在项目初期确定图床类型
- 如需迁移，请手动处理已有图片

### 文件夹管理

- **本地存储**：支持创建和管理文件夹
- **第三方图床**：文件夹功能取决于对应服务商的支持情况

## 故障排除

### 常见问题

**1. 第三方图床上传失败**
- 检查 SDK 是否正确安装
- 验证配置信息是否正确
- 确认网络连接正常
- 查看控制台错误日志

**2. 图片无法显示**
- 检查图床配置中的域名设置
- 确认图片 URL 格式正确
- 验证 CDN 或自定义域名配置

**3. 配置保存失败**
- 确认所有必填项已填写
- 检查网络连接
- 重新登录后再试

### 日志查看

后端日志会显示图床相关的操作信息：
```
[Image API] 图床配置已更新: { type: 'aliyun', ... }
[Image API] 阿里云OSS SDK未安装，跳过阿里云支持
```

## 安全建议

1. **密钥安全**：
   - 不要在代码中硬编码密钥
   - 定期轮换访问密钥
   - 使用最小权限原则

2. **访问控制**：
   - 配置适当的存储桶访问策略
   - 启用防盗链功能（如支持）
   - 考虑使用 CDN 加速和安全防护

3. **备份策略**：
   - 定期备份重要图片
   - 考虑跨地域备份
   - 测试恢复流程

## 性能优化

1. **CDN 加速**：
   - 配置 CDN 加速域名
   - 启用适当的缓存策略

2. **图片压缩**：
   - 上传前适当压缩图片
   - 使用合适的图片格式

3. **批量操作**：
   - 避免频繁的单个文件操作
   - 合理组织文件夹结构

---

如有问题，请查看项目文档或提交 Issue。